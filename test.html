<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>QuizData 生成器（aId 自动增长）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 900px;
      margin: 30px auto;
      padding: 0 15px;
    }
    h1 { font-size: 22px; }
    input, textarea {
      width: 100%;
      padding: 6px;
      margin: 4px 0 10px;
      box-sizing: border-box;
    }
    .question, .answer {
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .answers { margin-left: 20px; }
    button {
      padding: 6px 10px;
      margin: 4px;
      border-radius: 6px;
      border: 1px solid #2b7cff;
      background-color: #2b7cff;
      color: white;
      cursor: pointer;
    }
    button.secondary {
      background: #f2f2f2;
      color: #333;
      border-color: #ccc;
    }
    textarea#output {
      height: 250px;
      font-family: monospace;
    }
  </style>
</head>
<body>

<h1>QuizData 生成器（aId 自动增长）</h1>

<label>标题 (title)</label>
<input id="titleInput" placeholder="请输入 quiz 标题" />

<label>主图文件名或 URL (mainPic)</label>
<input id="mainPicInput" placeholder="例如：main.jpg 或 https://..." />

<label>主题标签 (thems，用逗号分隔)</label>
<input id="themsInput" placeholder="例如：Chat, Personnalité, VR" />

<h2>问题列表</h2>
<div id="questionsContainer"></div>
<button id="addQuestionBtn">＋ 添加问题</button>

<h2>生成的 quizData JS</h2>
<textarea id="output" readonly></textarea><br>
<button id="generateBtn">生成 quizData</button>
<button id="copyBtn" class="secondary">复制到剪贴板</button>
<button id="downloadBtn" class="secondary">下载 JS 文件</button>

<script>
  const container = document.getElementById("questionsContainer");
  const output = document.getElementById("output");

  // 添加新问题
  function addQuestion(data = null) {
    const qDiv = document.createElement("div");
    qDiv.className = "question";

    qDiv.innerHTML = `
      <label>问题文本 (question)</label>
      <input class="qText" placeholder="输入题目" value="${data?.question || ''}">
      <label>题目图片文件名或 URL (pic)</label>
      <input class="qPic" placeholder="pic.jpg 或 https://..." value="${data?.pic || ''}">
      <div class="answers">
        <h4>答案选项</h4>
        <div class="answersContainer"></div>
        <button class="addAnswerBtn" type="button">＋ 添加答案</button>
      </div>
      <button class="removeQ secondary" type="button">删除此问题</button>
    `;

    const answersContainer = qDiv.querySelector(".answersContainer");
    const addAnswerBtn = qDiv.querySelector(".addAnswerBtn");
    addAnswerBtn.addEventListener("click", () => addAnswer(answersContainer));

    qDiv.querySelector(".removeQ").addEventListener("click", () => {
      qDiv.remove();
    });

    // 如果有预置答案
    if (data?.answers) {
      data.answers.forEach(ans => addAnswer(answersContainer, ans));
    }

    container.appendChild(qDiv);
  }

  // 自动获取下一个 aId
  function getNextAId(answersContainer) {
    const existing = [...answersContainer.querySelectorAll(".aId")].map(
            i => Number(i.value) || 0
    );
    return existing.length ? Math.max(...existing) + 1 : 1;
  }

  // 添加答案
  function addAnswer(container, data = null) {
    const nextId = data?.aId || getNextAId(container);
    const div = document.createElement("div");
    div.className = "answer";
    div.innerHTML = `
      <label>答案文本 (answer)</label>
      <input class="aText" placeholder="输入答案" value="${data?.answer || ''}">
      <label>答案图片 (aPic，可留空)</label>
      <input class="aPic" placeholder="a.jpg 或 https://..." value="${data?.aPic || ''}">
      <label>答案ID (aId)</label>
      <input type="number" class="aId" value="${nextId}" readonly style="background:#f9f9f9;">
      <button class="removeA secondary" type="button">删除答案</button>
    `;
    div.querySelector(".removeA").addEventListener("click", () => div.remove());
    container.appendChild(div);
  }

  // 生成 quizData
  function generateQuizData() {
    const title = document.getElementById("titleInput").value.trim();
    const mainPic = document.getElementById("mainPicInput").value.trim();
    const thems = document.getElementById("themsInput").value.split(",").map(t => t.trim()).filter(Boolean);
    const questions = [];

    document.querySelectorAll(".question").forEach(q => {
      const questionText = q.querySelector(".qText").value.trim();
      const pic = q.querySelector(".qPic").value.trim();
      const answers = [];
      q.querySelectorAll(".answer").forEach(a => {
        answers.push({
          answer: a.querySelector(".aText").value.trim(),
          aPic: a.querySelector(".aPic").value.trim(),
          aId: Number(a.querySelector(".aId").value.trim()) || 0
        });
      });
      if (questionText) questions.push({ question: questionText, pic, answers });
    });

    const quizData = {
      title,
      mainPic,
      thems,
      questions,
      toAnswer: 10000
    };

    const jsText = "let quizData = " + JSON.stringify(quizData, null, 2) + ";";
    output.value = jsText;
    return jsText;
  }

  // 事件绑定
  document.getElementById("addQuestionBtn").addEventListener("click", () => addQuestion());
  document.getElementById("generateBtn").addEventListener("click", generateQuizData);

  document.getElementById("copyBtn").addEventListener("click", async () => {
    await navigator.clipboard.writeText(output.value);
    alert("已复制到剪贴板！");
  });

  document.getElementById("downloadBtn").addEventListener("click", () => {
    const blob = new Blob([output.value], { type: "application/javascript" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "quizData.js";
    a.click();
  });

  // 默认添加一个示例问题
  addQuestion({
    question: "示例问题：你最喜欢的动物？",
    pic: "example.jpg",
    answers: [
      { answer: "猫", aPic: "", aId: 1 },
      { answer: "狗", aPic: "", aId: 2 }
    ]
  });
</script>
</body>
</html>
